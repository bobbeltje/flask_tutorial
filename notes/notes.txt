
# vid 01

# setting up the project
python3 -m venv venv
. venv/bin/activate
pip3 install flask
mkdir Flask_Blog
# create flaskblog.py with hello world example
export FLASK_APP=flaskblog.py
# to set debugger mode (seems activated by default)
export FLASK_DEBUG=1
# for input forms
pip3 install flask-wtf
# ORM: object relational mapping for interacting with database
# when changing database, python code will remain the same
pip3 install flask-sqlalchemy
# create database from the command line
from flaskblog import db
from flaskblog import User, Post
db.create_all()
# add and create users
user_1 = User(username='Corey', email='C@demo.com', password='password')
db.session.add(user_1)
user_2 = User(username='JohnDoe', email='jd@demo.com', password='password')
db.session.add(user_2)
db.session.commit()
# querying
User.query.all()
User.query.first()
User.query.filter_by(username='Corey').all()
User.query.filter_by(username='Corey').first()
user = User.query.filter_by(username='Corey').first()
user
user.id
user = User.query.get(1)
user.posts
# add some posts (using user.id)
post_1 = Post(title='Blog 1', content='First Post Content!', user_id=user.id)
post_2 = Post(title='Blog 2', content='Second Post Content!', user_id=user.id)
db.session.add(post_1)
db.session.add(post_2)
db.session.commit()
user.posts
for post in user.posts:
    print(post.title)
post = Post.query.first()
post
post.user_id
post.author
# recreate database
db.drop_all()
db.create_all()
User.query.all()
Post.query.all()

# for hashing passwords
pip3 install flask-bcrypt
# for login
pip3 install flask-login
# for resizing images
pip3 install Pillow

# users
CoreyMSchafer@gmail.com
TestUser@demo.com
password: testing

# vid 09

# adding data in vid09
from flaskblog import db
from flaskblog.models import User, Post
import json
with open('../notes/sample_data.json') as f: 
    d = json.load(f) 
for p in d: 
    post = Post(title=p['title'], content=p['content'], user_id=p['user_id']) 
    db.session.add(post)
db.session.commit()

# vid 10

pip3 install flask-mail

# vid 13

# to create pip requirements file:
pip freeze > requirements.txt
# mv blog to server
scp -r Flask_Blog/ user@ip:~/
# prepare server
sudo apt install python3-pip
sudo apt install python3-venv
python3 -m venv Flask_Blog/venv
source venv/bin/activate
pip install -r requirements.txt

# create config file (instead of using os.environ.get)
sudo nano /etc/config.json 
# enter:
{
        "SECRET_KEY": "beaadd39d35e24a7746cce7a6397632a",
        "SQLALCHEMY_DATABASE_URI": "sqlite:///site.db" ,
        "EMAIL_USER": "myemail@example.com",
        "EMAIL_PASS": "my_password"
}
# and save
# edit flaskblog/config.py and add at the top:
with open('etc/config.json') as config_file:
    config = json.load(config_file)
# then change all os.environ.get to config.get
# and save

export FLASK_APP=run.py
flask run --host=0.0.0.0  # to make the app visible to the outside
